---
import Layout from '../../layouts/Base.astro';
import '../../styles/subcategory.css';
import { getCollection } from 'astro:content';
import SubcategoryProductCard from '../../components/SubcategoryProductCard.astro';
import ProductSidebar from '../../components/ProductSidebar.astro';
import RelatedProductsGrid from '../../components/RelatedProductsGrid.astro';
import CotizacionForm from '../../components/CotizacionForm.astro';

// 1. Obtener todos los productos de la categor铆a conexiones-herrajes
const todosProductos = (await getCollection('productos', ({ data }) =>
  data.categoria === 'conexiones-herrajes'
)).sort((a, b) => a.data.orden - b.data.orden);

// 2. Filtrar por subcategor铆a: Chiflones de Tres Pasos
const productosSubcategoria = todosProductos.filter(p => p.data.subcategoria === 'chiflones');

// 3. Obtener otros productos para secci贸n de relacionados
const otrosProductos = todosProductos.filter(p => !productosSubcategoria.includes(p));

// 4. Definir subcategor铆as para navegaci贸n
const subcategorias = [
  { slug: 'adaptadores', nombre: 'Adaptadores de Bronce', descripcion: 'Conversi贸n entre roscas NH, NPT, Storz', activo: false },
  { slug: 'wye', nombre: 'Conexi贸n Y (Wye)', descripcion: 'Derivaci贸n en dos salidas', activo: false },
  { slug: 'siamesa', nombre: 'Toma Siamesa FDC', descripcion: 'Conexi贸n para bomberos', activo: false },
  { slug: 'coples', nombre: 'Coples y Reducciones', descripcion: 'Conexi贸n r谩pida Storz', activo: false },
  { slug: 'chiflones', nombre: 'Chiflones de Tres Pasos', descripcion: 'Control de patr贸n de descarga', activo: true },
  { slug: 'accesorios', nombre: 'Accesorios y Herrajes', descripcion: 'Tapones, caps, niples', activo: false },
];
---

<Layout
  title="Chiflones de Tres Pasos Neblina y Chorro | M茅xico"
  description="Chiflones de tres pasos para control de patr贸n: cerrado, neblina y chorro directo. Serie Chief XD Elkhart Brass. UL 401. M茅xico."
  activePage="equipos"
  heroTitle="Chiflones de Tres Pasos"
  heroIntro="Boquillas de control manual con tres posiciones de operaci贸n: cerrado, neblina y chorro directo. Dise帽ados para gabinetes contra incendio y brigadas de primera respuesta que requieren control b谩sico pero efectivo del patr贸n de descarga."
  heroBadge="Conexiones y Herrajes"
  heroMetrics={[
    { valor: "3", texto: "Posiciones" },
    { valor: "UL 401", texto: "Certificaci贸n" },
    { valor: "100", texto: "GPM m谩x." }
  ]}
  heroPrimaryText="Ver Cat谩logo"
  heroPrimaryLink="#catalogo"
  heroSecondaryText="Solicitar Cotizaci贸n"
  heroSecondaryLink="#cotizar"
  heroShowRightContent={true}
>

  <!-- HERO CONTENT -->
  <Fragment slot="hero-content">
    <p>Los <strong>chiflones de tres pasos</strong> son boquillas de control manual que permiten alternar entre posici贸n cerrada, patr贸n de neblina y chorro directo mediante un simple giro del cabezal. Son la soluci贸n ideal para gabinetes contra incendio en edificios comerciales, hospitales e industrias donde el personal de brigada necesita una herramienta intuitiva y confiable sin la complejidad de boquillas autom谩ticas.</p>
    <p><strong>Gama de M茅xico</strong> distribuye chiflones certificados UL 401 de Elkhart Brass, fabricados en bronce cromado resistente a la corrosi贸n. Estos dispositivos ofrecen flujos de 30 a 100 GPM dependiendo del modelo y presi贸n de operaci贸n, con dise帽o ergon贸mico que facilita el agarre incluso con guantes. Ideales para complementar sistemas de manguera de 1-1/2" en instalaciones que cumplen NOM-002-STPS.</p>
  </Fragment>

  <!-- CONTENT + SIDEBAR -->
  <section class="subcat-content">
    <div class="container">
      <div class="subcat-layout">

        <!-- MAIN CONTENT -->
        <main class="subcat-main">
          <div class="catalog-header">
            <div class="catalog-header__text">
              <h2 class="catalog-header__title">Cat谩logo de Adaptadores de Bronce</h2>
              <p class="catalog-header__desc">Selecciona el modelo que mejor se adapte a tu instalaci贸n</p>
            </div>
            <div class="catalog-header__count">
              <span class="catalog-header__number">{productosSubcategoria.length}</span>
              <span class="catalog-header__label">producto{productosSubcategoria.length !== 1 ? 's' : ''}</span>
            </div>
          </div>

          <!-- Products Grid -->
          <div class="categories__grid">
            {productosSubcategoria.map((producto) => (
              <SubcategoryProductCard
                title={producto.data.title}
                description={producto.data.description}
                brand={producto.data.marca}
                image={producto.data.imagen}
                productSlug={producto.id}
                flow={producto.data.flujo}
                material={producto.data.material}
                certifications={producto.data.certificaciones}
              />
            ))}
          </div>

          {productosSubcategoria.length === 0 && (
            <div class="catalog-empty">
              <div class="catalog-empty__icon"></div>
              <h3 class="catalog-empty__title">Pr贸ximamente m谩s opciones</h3>
              <p class="catalog-empty__text">Estamos agregando m谩s adaptadores de diferentes marcas. Solicita una cotizaci贸n personalizada.</p>
              <a href="#cotizar" class="btn btn--primary">Solicitar Cotizaci贸n</a>
            </div>
          )}

          <!-- Tech Info -->
          <div class="tech-info">
            <h3 class="tech-info__title">Especificaciones T茅cnicas de Adaptadores</h3>
            <div class="tech-info__grid">
              <div class="tech-info__item">
                <span class="tech-info__label">Presi贸n de trabajo</span>
                <span class="tech-info__value">250-300 PSI</span>
              </div>
              <div class="tech-info__item">
                <span class="tech-info__label">Presi贸n de prueba</span>
                <span class="tech-info__value">1,000 PSI</span>
              </div>
              <div class="tech-info__item">
                <span class="tech-info__label">Di谩metros</span>
                <span class="tech-info__value">1" a 6"</span>
              </div>
              <div class="tech-info__item">
                <span class="tech-info__label">Roscas</span>
                <span class="tech-info__value">NH, NPT, Storz</span>
              </div>
              <div class="tech-info__item">
                <span class="tech-info__label">Temperatura</span>
                <span class="tech-info__value">-65掳F a 250掳F</span>
              </div>
              <div class="tech-info__item">
                <span class="tech-info__label">Material</span>
                <span class="tech-info__value">Bronce / Aluminio</span>
              </div>
            </div>
          </div>

          <!-- CTA Final -->
          <div class="subcat-cta-final">
            <div class="subcat-cta-final__content">
              <h3 class="subcat-cta-final__title">驴No encuentras la configuraci贸n que necesitas?</h3>
              <p class="subcat-cta-final__desc">Tenemos acceso al cat谩logo completo de Elkhart Brass. Cont谩ctanos para adaptadores en roscas especiales o configuraciones personalizadas.</p>
            </div>
            <a href="#cotizar" class="btn btn--primary">Solicitar Cotizaci贸n Especial</a>
          </div>
        </main>

        <!-- SIDEBAR -->
        <ProductSidebar
          navTitulo="Tipos de Conexiones"
          subcategorias={subcategorias}
          baseUrl="/conexiones"
          backLinkHref="/conexiones-herrajes-contra-incendios"
          backLinkTexto="Ver todas las conexiones"
          certificaciones={[
            { siglas: "FM", nombre: "Factory Mutual" },
            { siglas: "UL", nombre: "UL Listed" },
            { siglas: "NOM", nombre: "NOM-002-STPS" }
          ]}
          marcas={["Dixon", "Elkhart Brass", "Harrington", "Action Coupling"]}
          aplicaciones={[
            "Descarga de agua",
            "Aplicaciones industriales",
            "Limpieza de 谩reas",
            "Gabinetes contra incendio"
          ]}
          productosRelacionados={[
            { href: "/gabinetes-hidrantes-contra-incendios", nombre: "Gabinetes e Hidrantes" },
            { href: "/mangueras-contra-incendios", nombre: "Mangueras Contra Incendios" },
            { href: "/valvulas-contra-incendios", nombre: "V谩lvulas Contra Incendios" },
            { href: "/boquillas-contra-incendios", nombre: "Boquillas Contra Incendios" }
          ]}
        />

      </div>
    </div>
  </section>

  <!-- RELATED PRODUCTS -->
  <RelatedProductsGrid
    titulo="Otras Conexiones y Herrajes"
    subtitulo="Explora m谩s opciones para tu sistema contra incendios"
    productos={otrosProductos}
    maxProductos={3}
    verTodosLink="/conexiones-herrajes-contra-incendios"
    verTodosTexto="Ver todas las conexiones"
  />

  <CotizacionForm
    titulo="Cotiza Chiflones"
    tipoEquipo="Conexiones y herrajes"
    pagina="Conexiones Chiflones"
  />

</Layout>
