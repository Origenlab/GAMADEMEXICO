---
// =============================================================================
// Blog Category Index - P√°gina de categor√≠a /blog/[categoria-contra-incendios]
// Hero profesional de dos columnas como el index principal
// =============================================================================

import Layout from '../../../layouts/Base.astro';
import { getCollection } from 'astro:content';
import BlogGrid from '../../../components/blog/BlogGrid.astro';
import BlogCategories from '../../../components/blog/BlogCategories.astro';
import {
  getCategoriesWithCount,
  CATEGORY_LABELS,
  CATEGORY_SLUGS,
  SLUG_TO_CATEGORY,
} from '../../../lib/blogHelpers';
import { buildBreadcrumbSchema } from '../../../lib/seo';

// Metadata completa de categor√≠as para SEO y Hero
const CATEGORY_META: Record<string, {
  title: string;
  description: string;
  heroContent: string[];
  metrics: Array<{ valor: string; texto: string }>;
}> = {
  monitores: {
    title: 'Gu√≠as T√©cnicas de Monitores Contra Incendios',
    description: 'Art√≠culos profesionales sobre selecci√≥n, instalaci√≥n y mantenimiento de monitores contra incendios. Normatividad NFPA 15, certificaciones FM/UL y mejores pr√°cticas.',
    heroContent: [
      'Nuestros art√≠culos sobre <strong>monitores contra incendios</strong> cubren desde la selecci√≥n t√©cnica seg√∫n caudal y alcance, hasta procedimientos de mantenimiento preventivo conforme a NFPA 25. Contenido desarrollado por ingenieros con experiencia en instalaciones industriales, petroqu√≠micas y de almacenamiento.',
      'Aprende a elegir entre monitores tipo coraz√≥n y cuello de cisne, entiende las diferencias entre certificaciones FM Approved y UL Listed, y conoce los criterios de posicionamiento para m√°xima cobertura. Gu√≠as pr√°cticas para responsables de seguridad, instaladores y firmas de ingenier√≠a.',
    ],
    metrics: [
      { valor: 'NFPA 15', texto: 'Normativa aplicable' },
      { valor: 'FM/UL', texto: 'Certificaciones' },
      { valor: '500-2000', texto: 'GPM t√≠picos' },
    ],
  },
  boquillas: {
    title: 'Gu√≠as T√©cnicas de Boquillas Contra Incendios',
    description: 'Art√≠culos sobre boquillas contra incendios: tipos, selecci√≥n por GPM, patrones de descarga y certificaciones. Gu√≠as para brigadas y profesionales.',
    heroContent: [
      'Art√≠culos t√©cnicos sobre <strong>boquillas contra incendios</strong> para brigadas industriales, bomberos y responsables de seguridad. Desde boquillas tipo pistola hasta turbo jet, cubrimos selecci√≥n por caudal, patrones de descarga y compatibilidad con mangueras.',
      'Conoce las diferencias entre boquillas de chorro s√≥lido, niebla y espuma, entiende los rangos de operaci√≥n en GPM y aprende a seleccionar el equipo correcto seg√∫n el tipo de riesgo. Contenido basado en normatividad NFPA y especificaciones de fabricantes certificados.',
    ],
    metrics: [
      { valor: 'NFPA 1964', texto: 'Normativa aplicable' },
      { valor: '95-250', texto: 'GPM t√≠picos' },
      { valor: 'UL Listed', texto: 'Certificaci√≥n' },
    ],
  },
  mangueras: {
    title: 'Gu√≠as T√©cnicas de Mangueras Contra Incendios',
    description: 'Todo sobre mangueras contra incendios: tipos, selecci√≥n, cuidado y normativa NFPA 1961. Gu√≠as para mantenimiento y pruebas hidrost√°ticas.',
    heroContent: [
      'Gu√≠as completas sobre <strong>mangueras contra incendios</strong>: desde la selecci√≥n por di√°metro y presi√≥n de trabajo, hasta procedimientos de prueba hidrost√°tica conforme a NFPA 1962. Contenido para responsables de mantenimiento y brigadas industriales.',
      'Aprende las diferencias entre mangueras de chaqueta simple, doble forro y Blindex, conoce los criterios de almacenamiento y enrollado, y domina las inspecciones peri√≥dicas. Art√≠culos pr√°cticos con enfoque en cumplimiento normativo y vida √∫til del equipo.',
    ],
    metrics: [
      { valor: 'NFPA 1961', texto: 'Fabricaci√≥n' },
      { valor: 'NFPA 1962', texto: 'Mantenimiento' },
      { valor: '300 PSI', texto: 'Presi√≥n t√≠pica' },
    ],
  },
  valvulas: {
    title: 'Gu√≠as T√©cnicas de V√°lvulas Contra Incendios',
    description: 'Art√≠culos sobre v√°lvulas para sistemas contra incendios: OS&Y, mariposa, retenci√≥n y globe. Instalaci√≥n, mantenimiento y certificaciones.',
    heroContent: [
      'Art√≠culos t√©cnicos sobre <strong>v√°lvulas contra incendios</strong> para sistemas de rociadores, standpipes y redes hidr√°ulicas. Cubrimos v√°lvulas OS&Y, mariposa con supervisi√≥n, retenci√≥n y globe conforme a NFPA 13 y NFPA 25.',
      'Conoce los requisitos de instalaci√≥n, procedimientos de inspecci√≥n trimestral y anual, y criterios de selecci√≥n seg√∫n aplicaci√≥n. Gu√≠as para ingenieros de proyecto, instaladores certificados y responsables de mantenimiento de sistemas contra incendios.',
    ],
    metrics: [
      { valor: 'NFPA 13', texto: 'Dise√±o sistemas' },
      { valor: 'NFPA 25', texto: 'Inspecci√≥n' },
      { valor: 'FM/UL', texto: 'Certificaciones' },
    ],
  },
  'conexiones-herrajes': {
    title: 'Gu√≠as T√©cnicas de Conexiones y Herrajes',
    description: 'Art√≠culos sobre conexiones contra incendios: adaptadores, siamesas FDC, coples Storz, Wye y herrajes de bronce para sistemas hidr√°ulicos.',
    heroContent: [
      'Gu√≠as t√©cnicas sobre <strong>conexiones y herrajes</strong> para sistemas contra incendios: adaptadores NST/NH, coples Storz, tomas siamesas FDC, conexiones Y y reducciones. Contenido para instaladores y personal de mantenimiento.',
      'Aprende sobre compatibilidad de roscas, materiales adecuados seg√∫n aplicaci√≥n, y procedimientos de instalaci√≥n conforme a NFPA 14. Art√≠culos pr√°cticos con especificaciones t√©cnicas y mejores pr√°cticas de la industria.',
    ],
    metrics: [
      { valor: 'NFPA 14', texto: 'Standpipes' },
      { valor: 'NST/Storz', texto: 'Roscas comunes' },
      { valor: 'Bronce', texto: 'Material t√≠pico' },
    ],
  },
  'gabinetes-hidrantes': {
    title: 'Gu√≠as T√©cnicas de Gabinetes e Hidrantes',
    description: 'Todo sobre gabinetes contra incendios e hidrantes: tipos, instalaci√≥n, normativa NFPA 14 y equipamiento completo para edificios.',
    heroContent: [
      'Art√≠culos sobre <strong>gabinetes e hidrantes</strong> contra incendios: desde gabinetes tipo 30ME hasta hidrantes de banqueta y poste. Cubrimos requisitos de instalaci√≥n, equipamiento y mantenimiento conforme a NFPA 14.',
      'Conoce las especificaciones de gabinetes para edificios comerciales e industriales, requisitos de accesibilidad, componentes obligatorios y procedimientos de inspecci√≥n. Gu√≠as para arquitectos, instaladores y responsables de seguridad.',
    ],
    metrics: [
      { valor: 'NFPA 14', texto: 'Standpipes' },
      { valor: 'Clase I/II/III', texto: 'Clasificaci√≥n' },
      { valor: 'NOM', texto: 'Cumplimiento MX' },
    ],
  },
};

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ data }) => !data.draft);
  const categories = [...new Set(posts.map((p) => p.data.categoria))];

  return categories.map((category) => {
    const categorySlug = CATEGORY_SLUGS[category] || category;
    const categoryPosts = posts
      .filter((p) => p.data.categoria === category)
      .sort((a, b) => new Date(b.data.fecha).getTime() - new Date(a.data.fecha).getTime());

    return {
      params: { categoria: categorySlug },
      props: {
        category,
        categorySlug,
        posts: categoryPosts,
      },
    };
  });
}

const { category, categorySlug, posts } = Astro.props;

// Obtener metadata de la categor√≠a
const defaultMeta = {
  title: `Art√≠culos sobre ${CATEGORY_LABELS[category] || category}`,
  description: `Gu√≠as t√©cnicas sobre ${CATEGORY_LABELS[category] || category} en el blog de Gama de M√©xico.`,
  heroContent: [
    `Art√≠culos profesionales sobre <strong>${CATEGORY_LABELS[category] || category}</strong> desarrollados por nuestro equipo t√©cnico. Contenido pr√°ctico con enfoque en normatividad y mejores pr√°cticas de la industria.`,
    'Gu√≠as para profesionales de seguridad, instaladores certificados y responsables de mantenimiento de sistemas contra incendios en M√©xico.',
  ],
  metrics: [
    { valor: `${posts.length}`, texto: 'Art√≠culos' },
    { valor: 'NFPA', texto: 'Normativas' },
    { valor: 'NOM', texto: 'Cumplimiento' },
  ],
};

const meta = CATEGORY_META[category] || defaultMeta;
const categoryLabel = CATEGORY_LABELS[category] || category;

// Obtener todas las categor√≠as para navegaci√≥n
const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const allCategories = getCategoriesWithCount(allPosts);

// Schema breadcrumb
const breadcrumbSchema = buildBreadcrumbSchema([
  { name: 'Inicio', url: '/' },
  { name: 'Blog', url: '/blog' },
  { name: categoryLabel, url: `/blog/${categorySlug}` },
]);
---

<Layout
  title={`${meta.title} | Blog Gama de M√©xico`}
  description={meta.description}
  heroTitle={meta.title}
  heroIntro={meta.description}
  heroBadge="Blog T√©cnico Especializado"
  heroMetrics={meta.metrics}
  heroPrimaryText="Solicitar Asesor√≠a"
  heroPrimaryLink="#cotizar"
  heroSecondaryText="Ver Equipos"
  heroSecondaryLink={`/${category === 'gabinetes-hidrantes' ? 'gabinetes-hidrantes' : category + '-contra-incendios'}`}
  heroShowRightContent={true}
  structuredData={[breadcrumbSchema]}
>
  <Fragment slot="hero-content">
    {meta.heroContent.map((paragraph) => (
      <p set:html={paragraph} />
    ))}
  </Fragment>

  <!-- Navegaci√≥n de categor√≠as -->
  <BlogCategories categories={allCategories} activeCategory={category} />

  <!-- Grid de art√≠culos -->
  <BlogGrid
    posts={posts}
    titulo={`${posts.length} ${posts.length === 1 ? 'art√≠culo' : 'art√≠culos'} sobre ${categoryLabel}`}
    subtitulo="Contenido t√©cnico desarrollado por ingenieros especializados"
    columns={3}
    categorySlug={categorySlug}
  />

  {posts.length === 0 && (
    <section class="blog-empty">
      <div class="container">
        <div class="blog-empty__content">
          <div class="blog-empty__icon">üìù</div>
          <h2 class="blog-empty__title">Pr√≥ximamente</h2>
          <p class="blog-empty__text">Estamos preparando art√≠culos t√©cnicos sobre {categoryLabel}.</p>
          <a href="/blog" class="btn btn--primary">Ver todos los art√≠culos</a>
        </div>
      </div>
    </section>
  )}
</Layout>

<style>
  .blog-empty {
    padding: var(--spacing-3xl) 0;
    background: var(--color-accent);
  }

  .blog-empty__content {
    text-align: center;
    max-width: 500px;
    margin: 0 auto;
    padding: var(--spacing-2xl);
    background: var(--color-white);
    border-radius: var(--border-radius);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
  }

  .blog-empty__icon {
    font-size: 3rem;
    margin-bottom: var(--spacing-md);
  }

  .blog-empty__title {
    font-size: var(--font-size-xl);
    font-weight: 700;
    color: var(--color-secondary);
    margin: 0 0 var(--spacing-sm) 0;
  }

  .blog-empty__text {
    color: var(--color-text-light);
    margin-bottom: var(--spacing-lg);
  }
</style>
